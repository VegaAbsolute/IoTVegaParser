# Вега M-BUS-1 - конвертер M-BUS


## Описание устройства
<img src="https://iotvega.com/content/ru/si/mbus/ava.jpg" width="400" />

Конвертер Вега M-BUS-1 предназначен для считывания данных с устройств с интерфейсом M-BUS, с последующим накоплением и передачей этой информации в сеть LoRaWAN®.
Кроме того, конвертер M-BUS-1 имеет два охранных входа, по срабатыванию которых отправляет в сеть LoRaWAN® сообщение о тревоге, и два выхода типа «открытый коллектор» для управления внешними устройствами.


## Описание полей данных

### Пакет с текущим состоянием

Пакет с текущим состоянием приходит на порт 2 и содержит следующие поля:
- `chargePercent` - заряд батареи (%), тип данных `Number`;
- `currentSettings` - значение основных настроек датчика, тип данных `Object`, содержит следующие поля:
    - `ack` - запрос подтверждения пакетов (**true** - если включен и **false** - если отключен), тип данных `Boolean`;
    - `connectPeriodMin` - период выхода на связь (минуты), тип данных `Number`;
    - `typeActivation` - тип активации в сети LoRaWan, тип данных `String`;
    - `typeInput1` - тип входа 1 (**security** - охранный, **unknown** - не выбран), тип данных `String`;
    - `typeInput2` - тип входа 2 (**security** - охранный, **unknown** - не выбран), тип данных `String`;
- `currentFlowCoolantLH16` - текущий расход теплоносителя (л/ч) в формате uint16 (устаревшее поле), тип данных `Number`;
- `currentFlowCoolantLH32` - текущий расход теплоносителя (л/ч) в формате uint32 (актуальное поле), тип данных `Number`;
- `decoder` - имя и версия дешифратора, тип данных `String`;
- `energyConsumedWh` - количество потребленной тепловой энергии (Вт*ч), тип данных `Number`;
- `environment` - среда (вода, газ, и т.д.), тип данных `String`;
- `operatingTimeH` - время наработки (ч), тип данных `Number`;
- `powerW` - мощность (Вт), тип данных `Number`;
- `serial` - серийный номер прибора, тип данных `Number`;
- `statusDecode` - состояние расшифровки данных (**true** если расшифровка успешна и **false** если неуспешна), тип данных `Boolean`;
- `temperatureFlow` - температура в подающем трубопроводе (°С), тип данных `Number`;
- `temperatureReturnLine` - температура в обратном трубопроводе (°С), тип данных `Number`;
- `totalVolumeCoolantL` - суммарный объем теплоносителя (л), тип данных `Number`;
- `time` - время снятия показаний, передаваемых в пакете в формате Unix-time (с), тип данных `Number`;
- `timeStringISO` - время снятия показаний, передаваемых в пакете в формате ISO, тип данных `String`;
- `type` - тип пакета, тип данных `String`.


### Пакет с запросом корректировки времени

Пакет с запросом корректировки времени приходит на порт 4 и содержит следующие поля:
- `decoder` - имя и версия дешифратора, тип данных `String`;
- `statusDecode` - состояние расшифровки данных (**true** если расшифровка успешна и **false** если неуспешна), тип данных `Boolean`;
- `time` - время снятия показаний, передаваемых в пакете в формате Unix-time (с), тип данных `Number`;
- `timeStringISO` - время снятия показаний, передаваемых в пакете в формате ISO, тип данных `String`;
- `type` - тип пакета, тип данных `String`.


### Пакет с настройками

Пакет с настройками приходит на порт 3 и содержит следующие поля:
- `decoder` - имя и версия дешифратора, тип данных `String`;
- `settings` - текущие значения настроек устройства, тип данных `Object` (ключами объекта являются номера параметров);
- `statusDecode` - состояние расшифровки данных (**true** если расшифровка успешна и **false** если неуспешна), тип данных `Boolean`;
- `type` - тип пакета, тип данных `String`.

Объект параметра, содержит следующие поля:
- `id` - номера параметра, тип данных `Number`;
- `length` - длина значения параметра (байт), тип данных `Number`;
- `name` - имя параметра, тип данных `String`;
- `rawValue` - необработанное значение параметра, тип данных `String`;
- `value` - значение параметра, тип данных зависит от параметра.